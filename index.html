<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Ricerca Pacco per Tracking ID</title>
<style>
  body { font-family: Arial, sans-serif; padding: 20px; }
  #scanner { width: 100%; max-width: 600px; height: 300px; border: 1px solid #ccc; margin-top: 10px; }
  #status { margin-top: 10px; font-weight: bold; }
</style>
</head>
<body>

<h1>Trova il pacco con Tracking ID</h1>

<label for="trackingInput">Inserisci Tracking ID da cercare:</label><br />
<input type="text" id="trackingInput" placeholder="Es. ABC123456789" style="width: 300px; font-size: 1.2em;" /><br />

<button id="startScan">Avvia scansione pacchi</button>

<div id="scanner"></div>
<div id="status">Stato: in attesa di scansione...</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/quagga/0.12.1/quagga.min.js"></script>
<script>
  const trackingInput = document.getElementById('trackingInput');
  const status = document.getElementById('status');
  const scanner = document.getElementById('scanner');
  const startScanBtn = document.getElementById('startScan');

  let targetTrackingId = '';
  let scanning = false;

  function playBeep() {
    const ctx = new AudioContext();
    const oscillator = ctx.createOscillator();
    oscillator.type = 'sine';
    oscillator.frequency.setValueAtTime(1000, ctx.currentTime);
    oscillator.connect(ctx.destination);
    oscillator.start();
    oscillator.stop(ctx.currentTime + 0.2);
  }

  function vibrateDevice() {
    if (navigator.vibrate) {
      navigator.vibrate(200);
    }
  }

  function onDetected(result) {
    if (!scanning) return;
    const code = result.codeResult.code;
    if (code === targetTrackingId) {
      status.textContent = `Pacco trovato! Tracking ID: ${code}`;
      playBeep();
      vibrateDevice();
      Quagga.stop();
      scanning = false;
      startScanBtn.disabled = false;
    } else {
      status.textContent = `Codice letto: ${code} (non corrisponde)`;
    }
  }

  startScanBtn.addEventListener('click', () => {
    targetTrackingId = trackingInput.value.trim();
    if (!targetTrackingId) {
      alert('Inserisci un Tracking ID valido prima di iniziare la scansione.');
      return;
    }
    status.textContent = 'Avvio scansione...';
    startScanBtn.disabled = true;
    scanning = true;

    Quagga.init({
      inputStream : {
        name : "Live",
        type : "LiveStream",
        target: scanner,
        constraints: {
          facingMode: "environment" // usa la fotocamera posteriore
        },
      },
      decoder : {
        readers : ["code_128_reader","ean_reader","ean_8_reader","code_39_reader","upc_reader","upc_e_reader","codabar_reader"]
      }
    }, function(err) {
        if (err) {
            console.error(err);
            status.textContent = 'Errore nell\'avvio della scansione.';
            startScanBtn.disabled = false;
            scanning = false;
            return;
        }
        Quagga.start();
        status.textContent = 'Scanner attivo, inquadra il codice del pacco.';
    });

    Quagga.onDetected(onDetected);
  });
</script>

</body>
</html>
