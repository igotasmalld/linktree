<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Ricerca Pacco per Ultime Cifre Tracking ID</title>
<style>
  body { font-family: Arial, sans-serif; padding: 20px; }
  label { font-weight: bold; margin-top: 10px; display: block; }
  input { font-size: 1.2em; padding: 5px; width: 300px; }
  #status { margin-top: 20px; font-weight: bold; font-size: 1.3em; }
</style>
</head>
<body>

<h1>Trova il pacco con ultime cifre Tracking ID</h1>

<label for="partialInput">Inserisci ultime 4 o 5 cifre del Tracking ID:</label>
<input type="text" id="partialInput" maxlength="5" autocomplete="off" />

<label for="scanInput">Scannerizza il codice del pacco qui:</label>
<input type="text" id="scanInput" autocomplete="off" autofocus />

<div id="status">Stato: in attesa di scansione...</div>

<script>
  const partialInput = document.getElementById('partialInput');
  const scanInput = document.getElementById('scanInput');
  const status = document.getElementById('status');

  // Funzione per feedback sonoro
  function playBeep() {
    try {
      const ctx = new AudioContext();
      const oscillator = ctx.createOscillator();
      oscillator.type = 'sine';
      oscillator.frequency.setValueAtTime(1000, ctx.currentTime);
      oscillator.connect(ctx.destination);
      oscillator.start();
      oscillator.stop(ctx.currentTime + 0.2);
    } catch (e) {
      // AudioContext non supportato
      console.warn('AudioContext non supportato');
    }
  }

  // Funzione per vibrazione (se supportata)
  function vibrateDevice() {
    if (navigator.vibrate) {
      navigator.vibrate(200);
    }
  }

  // Gestione evento Enter nella casella di scansione
  scanInput.addEventListener('keydown', function(event) {
    if (event.key === 'Enter') {
      event.preventDefault();

      const partial = partialInput.value.trim();
      const scannedCode = scanInput.value.trim();

      if (partial.length < 4) {
        status.textContent = 'Inserisci almeno 4 cifre nelle ultime cifre del tracking ID.';
        scanInput.value = '';
        return;
      }

      if (scannedCode.length === 0) {
        status.textContent = 'Scannerizza un codice valido.';
        return;
      }

      if (scannedCode.endsWith(partial)) {
        status.textContent = `Pacco trovato! Codice scannerizzato: ${scannedCode}`;
        playBeep();
        vibrateDevice();
      } else {
        status.textContent = `Codice scannerizzato: ${scannedCode} (non corrisponde)`;
      }

      // Pulisce la casella per la prossima scansione e la riporta a fuoco
      scanInput.value = '';
      scanInput.focus();
    }
  });

  // Per sicurezza, mettiamo il focus sulla casella di scansione all'apertura
  window.onload = () => {
    scanInput.focus();
  };
</script>

</body>
</html>
